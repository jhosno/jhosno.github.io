<script>
  lucide.createIcons();
  // Obtener el botón principal
  const scrollToTopBtn = document.getElementById("scrollToTopBtn");
  const progressCircle = document.querySelector(".progress-ring-circle");
  const circumference = 2 * Math.PI * 36; // radio = 36

  // Función para calcular el progreso del scroll
  function updateScrollProgress() {
    const scrollTotal =
      document.documentElement.scrollHeight - window.innerHeight;
    const scrollProgress = window.scrollY;
    const scrollPercentage = scrollProgress / scrollTotal;

    // Actualizar el anillo de progreso
    const offset = circumference - scrollPercentage * circumference;
    progressCircle.style.strokeDashoffset = offset;
  }

  // Mostrar/ocultar botón según el scroll
  window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
      scrollToTopBtn.classList.remove("opacity-0", "pointer-events-none");
      scrollToTopBtn.classList.add("opacity-100");
    } else {
      scrollToTopBtn.classList.add("opacity-0", "pointer-events-none");
      scrollToTopBtn.classList.remove("opacity-100");
    }

    updateScrollProgress();
  });

  // Función de scroll suave al hacer clic
  scrollToTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
  });

  // Crear partículas pixel al hacer hover
  scrollToTopBtn.addEventListener("mouseenter", () => {
    createPixelParticles();
  });

  function createPixelParticles() {
    const particlesContainer = scrollToTopBtn.querySelector(".pixel-particles");

    for (let i = 0; i <script 8; i++) {
      const particle = document.createElement("div");
      particle.className = "pixel-particle";

      // Posición aleatoria alrededor del botón
      const angle = (Math.PI * 2 * i) / 8;
      const distance = 30;
      const x = 40 + Math.cos(angle) * distance;
      const y = 40 + Math.sin(angle) * distance;

      particle.style.left = x + "px";
      particle.style.top = y + "px";
      particle.style.background = i % 2 === 0 ? "#FFFF00" : "#FF00FF";
      particle.style.animation = `particle-float 1s ease-out forwards`;
      particle.style.animationDelay = i * 0.05 + "s";

      particlesContainer.appendChild(particle);

      // Remover la partícula después de la animación
      setTimeout(() => {
        particle.remove();
      }, 1000);
    }
  }

  // Efecto de glitch en el texto del tooltip (opcional)
  scrollToTopBtn.addEventListener("mouseenter", () => {
    const tooltip = scrollToTopBtn.querySelector(".absolute");
    tooltip.style.animation = "glitch 0.3s ease-in-out";
  });

  scrollToTopBtn.addEventListener("mouseleave", () => {
    const tooltip = scrollToTopBtn.querySelector(".absolute");
    tooltip.style.animation = "none";
  });

  // Inicializar el progreso
  updateScrollProgress();

  // Mobile Menu Toggle
  const mobileMenuBtn = document.getElementById("mobileMenuBtn");
  const mobileMenu = document.getElementById("mobileMenu");

  mobileMenuBtn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden");
    mobileMenuBtn.classList.toggle("hamburger-active");
  });

  // Cerrar menu al hacer click en un link
  const mobileMenuLinks = mobileMenu.querySelectorAll("a");
  mobileMenuLinks.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("hidden");
      mobileMenuBtn.classList.remove("hamburger-active");
    });
  });

  // Cerrar menu al hacer scroll
  let lastScroll = 0;
  window.addEventListener("scroll", () => {
    const currentScroll = window.pageYOffset;
    if (currentScroll > lastScroll && currentScroll > 100) {
      mobileMenu.classList.add("hidden");
      mobileMenuBtn.classList.remove("hamburger-active");
    }
    lastScroll = currentScroll;
  });
</script>
