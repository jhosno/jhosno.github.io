---
layout: post
title:  "CatAPI - API de gatitos"
date:   2022-03-15 15:00:00 -0400
categories: [API, tutorial]
image: 15.png
alt: "APIRestful - Node y Heroku"
extract: "En esta ocasi√≥n vamos a hacer una APIRest de manera r√°pida con node.js y Heroku, y ser√° una API de gatitos"
---
En esta ocasi√≥n vamos a hacer una APIRest de manera r√°pida con node.js y Heroku, siguiendo los pasos del [tutorial de Ania Kub√≥w](https://www.youtube.com/watch?v=FLnxgSZ0DG4&list=TLPQMjEwMjIwMjKMhH1mDkbm0Q&index=4), ajustado para Windows 10 y utilizando tls-test, seg√∫n las [recomendaciones de github](https://github.blog/2021-08-23-npm-registry-deprecating-tls-1-0-tls-1-1/) a la hora de hacer . La API ser√° sobre los gatitos del [refugio Apoyo Animal Santa Teresa](https://www.instagram.com/apoyoanimalst/?hl=es) (Venezuela) üê±üêà, a quienes puedes apoyar a trav√©s de los canales que tienen publicado en sus RRSS.

- Aqu√≠ est√° el repositorio ‚Üí [[link](https://github.com/jhosno/catapi)]
- Aqu√≠ est√° la APIRestful en l√≠nea‚Üí [[link](https://happycatsapi.herokuapp.com/cats)]

## Requerimientos:

- Node.js
- GIT
- Cuentas en GitHub y Heroku

Para empezar vamos a necesitar instalar unos repositorios de Node de manera global, el primero ser√° json-server y heroku, con el siguiente c√≥digo:

```bash
npm install -g json-server heroku
```

Necesitaremos tener el repositorio alojado en GitHub, as√≠ que la recomendaci√≥n es que crees un repositorio directamente en la p√°gina de GitHub, y luego hagas git clone, o agregues una carpeta local al repositorio, aqu√≠ puedes encontrar una [peque√±a gu√≠a de como](https://jhosno.github.io//git/github/Git-agregar-repo)

Lo siguiente que necesitamos es crear una carpeta, en este ejemplo lo llamaremos CatAPI, en donde vamos a crear un archivo que llamaremos db.json, este contendr√° lo siguiente:

```json
{
  "cats": [
    {
      "id": 0,
      "name": "michu",
      "size": "large",
      "eyecolor": "green",
      "nosecolor": "black",
      "coatpattern": "solid",
      "coattype": "wirehair",
      "coatcolors": [{ "coat0": "black" }, { "coat1": "" }, { "coat2": "" }]
    },
    {
      "id": 1,
      "name": "pancho",
      "size": "large",
      "eyecolor": "green",
      "nosecolor": "pink",
      "coatpattern": "tuxedo",
      "coattype": "longhair",
      "coatcolors": [
        { "coat0": "white" },
        { "coat1": "black" },
        { "coat2": "" }
      ]
    },
    {
      "id": 2,
      "name": "luna",
      "size": "medium",
      "eyecolor": "green",
      "nosecolor": "pink partialy black",
      "coatpattern": "tuxedo",
      "coattype": "longhair",
      "coatcolors": [
        { "coat0": "white" },
        { "coat1": "black" },
        { "coat2": "" }
      ]
    },

    {
      "id": 3,
      "name": "duquesa",
      "size": "large",
      "eyecolor": "green",
      "nosecolor": "pink",
      "coatpattern": "Patched tabby",
      "coatcolors": [
        { "coat0": "blue" },
        { "coat1": "cream" },
        { "coat2": "apricot" }
      ]
    }
  ]
}
```

Para confirmar que est√° en todo en orden, con la consola encima de la carpeta vamos a poner lo siguiente:

```bash
json-server --watch db.json
```

deber√≠a verse lo siguiente:

![Consola - Heroku building](/assets/images/content/catapi1.png){:class="img-responsive"}

Esto nos deja saber que podemos acceder a la API desde http://localhost:3000/

Crearemos un server.js para configurar algunas opciones del servidor. Para ver todas las opciones disponibles puedes consultar la documentaci√≥n de [JSON-server](https://www.npmjs.com/package/json-server#getting-started)

```jsx
const jsonServer = require('json-server');
const server = jsonServer.create();
const router = jsonServer.router('db.json');
const middlewares = jsonServer.defaults();
const port = process.env.PORT || 3000;

server.use(middlewares);
server.use(router);

server.listen(port);
```

El paso siguiente es instalar json-server en el proyecto:

```bash
npm i json-server
```

En el tutorial de Ania Kub√≥w el siguiente paso corresponde a lo siguiente:

```bash
npm i json-server --registry http://registry.npmjs.org
```

Pero esto es vamos a seguir las recomendaciones de GitHub, que corresponde a instalar TLS-Test

```bash
npm i -g http://tls-test.npmjs.com/tls-test-1.0.0.tgz
```

Continuamos con crear nuestro package.json  a trav√©s del comando init

```bash
npm init
```

En el package.json vamos a colocar en los scripts el siguiente comando:

```json
"start":"node server.js"
```

Y nos debe quedar algo como esto

```json
{
  "name": "catapi",
  "version": "1.0.0",
  "description": "Api de gattos ",
  "main": "index.js",
  "dependencies": {
    "json": "^11.0.0",
    "json-server": "^0.17.0"
  },
  "devDependencies": {},
  "scripts": {
    "test": "echo \\"Error: no test specified\\" && exit 1",
    "start":"node server.js"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/jhosno/catapi.git"
  },
  "keywords": [
    "apirestfull",
    "heroku"
  ],
  "author": "Jhosno",
  "license": "ISC",
  "bugs": {
    "url": "<https://github.com/jhosno/catapi/issues>"
  },
  "homepage": "<https://github.com/jhosno/catapi#readme>"
}
```

Luego de esto, hacemos install para que instale todos los paquetes necesarios

```bash
npm i
```

Ahora s√≠, vamos a hacer el registro en NPM, con el siguiente comando

```bash
npm config set registry https://registry.npmjs.org
```

Vamos a comprobar que tenemos Heroku instalado correctamente

```bash
heroku --version
```

Es importante estar loggeados en heroku, antes de continuar, as√≠ que colocamos el siguiente comando

```bash
heroku login
```

Lo siguiente es crear el proyecto en donde vamos a correr nuestra APIRestful, es importante que el nombre que escojas est√© disponible, para este ejemplo hemos usado <happycatsapi>

```bash
heroku create <nombre-del-proyecto>
```

Al finalizar heroku create, podemos acceder a la direcci√≥n del proyecto y veremos una pantalla como esta:

![Consola - Heroku building](/assets/images/content/catapi2.png){:class="img-responsive"}

Repetimos *heroku login* para confirmar que seguimos en l√≠nea, en este punto es importante que tengas tu repositorio de GitHub al d√≠a, as√≠ que te recomiendo que antes de estos pasos finales hagas *git push*. Ahora vamos a escribirlo siguiente en consola:

```bash
git push heroku main
```

Es fundamental que hagas push en la brecha en la que est√°s trabajando, en este caso es main, pero tambi√©n puede ser master u otra.  Siguiendo con el paso anterior, ver√°s algo parecido a esto al finalizar:

![Consola - Heroku building](/assets/images/content/catapi3.png){:class="img-responsive"}

¬°Ya est√° en l√≠nea ‚Üí [https://happycatsapi.herokuapp.com/cats](https://happycatsapi.herokuapp.com/cats) üî•üê±!

Tambi√©n puedes abrirlo directamente en consola con:

```bash
heroku open 
```

Creditos de la img: Bongo Cat Codes #2 - Jamming  by Caroline Artz [[link]](https://codepen.io/carolineartz/pen/qBOEzQa)
